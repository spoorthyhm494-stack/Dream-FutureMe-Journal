<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Settings</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* CSS Variables */
        :root {
            --color-primary: #5c67f2;
            --color-secondary: #ff7e5f;
            --color-accent: #f093fb;
            --color-text-dark: #333;
            --color-bg-light: #ffffff;
            --color-bg-gray: #f4f7f6;
            --navbar-bg-gradient: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        }

        /* General Styles */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Poppins', sans-serif; 
            line-height: 1.6; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-size: 400% 400%;
            animation: gradientBackground 15s ease infinite;
            color: #555; 
            min-height: 100vh;
            padding-top: 70px;
        }
        
        @keyframes gradientBackground {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .container { width: 90%; max-width: 1200px; margin: 0 auto; }
        
        /* Navbar */
        .navbar {
            background: var(--navbar-bg-gradient);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            height: 70px;
            animation: gradientShift 10s ease infinite;
            background-size: 200% 200%;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .nav-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 70px;
            padding: 0 2rem;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            text-decoration: none;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            animation: logoGlow 2s ease-in-out infinite;
        }
        
        @keyframes logoGlow {
            0%, 100% { text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3); }
            50% { text-shadow: 0 0 20px rgba(255, 255, 255, 0.8), 2px 2px 4px rgba(0, 0, 0, 0.3); }
        }

        .nav-links {
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }

        .nav-item {
            color: rgba(255, 255, 255, 0.85);
            text-decoration: none;
            font-weight: 500;
            padding: 5px 0;
            position: relative;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .nav-item:hover, .nav-item.active {
            color: white;
            font-weight: 600;
            transform: translateY(-2px);
        }

        .nav-item::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%) scaleX(0);
            height: 3px;
            width: 100%;
            background: linear-gradient(90deg, #ff7e5f, #f093fb);
            border-radius: 2px;
            transition: transform 0.3s ease;
        }

        .nav-item:hover::after, .nav-item.active::after {
            transform: translateX(-50%) scaleX(1);
        }

        /* Settings Container */
        .settings-container { 
            padding: 4rem 0; 
            min-height: 80vh; 
        }
        
        .settings-container h2 {
            color: white;
            font-size: 2.5rem;
            text-align: center;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
            animation: fadeInBounce 1s ease-out;
        }
        
        @keyframes fadeInBounce {
            0% { opacity: 0; transform: translateY(-30px) scale(0.9); }
            60% { transform: translateY(5px) scale(1.02); }
            100% { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        .settings-container > .container > p {
            text-align: center;
            color: white;
            font-size: 1.1rem;
            margin-bottom: 3rem;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
            animation: fadeIn 1s ease-out 0.3s backwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .settings-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 2rem; 
            margin-top: 2rem; 
        }
        
        .card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(249, 249, 255, 0.95) 100%);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transition: all 0.4s ease;
            animation: slideInUp 0.8s ease-out backwards;
            position: relative;
            overflow: hidden;
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s;
        }
        
        .card:hover::before {
            left: 100%;
        }
        
        .card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.25);
        }
        
        @keyframes slideInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .card:nth-child(1) { animation-delay: 0.1s; }
        .card:nth-child(2) { animation-delay: 0.3s; }
        
        .setting-group { margin-bottom: 2.5rem; }
        
        .setting-group h3 { 
            background: linear-gradient(90deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            border-bottom: 3px solid;
            border-image: linear-gradient(90deg, #667eea, #764ba2, #f093fb) 1;
            padding-bottom: 0.5rem; 
            margin-bottom: 1.5rem;
            font-size: 1.3rem;
        }
        
        .toggle-switch, .credential-display {
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 1rem 0;
            border-bottom: 1px solid rgba(238, 238, 238, 0.5);
            transition: all 0.3s ease;
        }
        
        .toggle-switch:hover, .credential-display:hover {
            background: linear-gradient(90deg, rgba(102, 126, 234, 0.05), rgba(240, 147, 251, 0.05));
            padding-left: 1rem;
            border-radius: 10px;
        }

        .credential-item { 
            display: flex; 
            flex-direction: column;
        }
        
        .credential-item .label { 
            font-size: 0.85rem; 
            color: #777; 
            margin-bottom: 4px; 
        }
        
        .credential-item .value { 
            font-weight: 600;
            background: linear-gradient(90deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* Custom Switch CSS */
        .switch { 
            position: relative; 
            display: inline-block; 
            width: 60px; 
            height: 34px; 
        }
        
        .switch input { opacity: 0; width: 0; height: 0; }
        
        .slider { 
            position: absolute; 
            cursor: pointer; 
            top: 0; 
            left: 0; 
            right: 0; 
            bottom: 0; 
            background: linear-gradient(135deg, #ccc, #e0e0e0);
            transition: .4s; 
            border-radius: 34px;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .slider:before { 
            position: absolute; 
            content: ""; 
            height: 26px; 
            width: 26px; 
            left: 4px; 
            bottom: 4px; 
            background: white;
            transition: .4s; 
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        input:checked + .slider { 
            background: linear-gradient(135deg, #667eea, #764ba2);
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.5);
            animation: sliderGlow 2s ease-in-out infinite;
        }
        
        @keyframes sliderGlow {
            0%, 100% { box-shadow: 0 0 15px rgba(102, 126, 234, 0.5); }
            50% { box-shadow: 0 0 25px rgba(102, 126, 234, 0.8); }
        }
        
        input:checked + .slider:before { 
            transform: translateX(26px); 
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        }
        
        .btn-primary {
            background: linear-gradient(90deg, #dc3545, #c0392b);
            color: white;
            animation: buttonPulse 2s ease-in-out infinite;
        }
        
        @keyframes buttonPulse {
            0%, 100% { box-shadow: 0 4px 10px rgba(220, 53, 69, 0.4); }
            50% { box-shadow: 0 6px 20px rgba(220, 53, 69, 0.6); }
        }
        
        .btn-primary:hover {
            background: linear-gradient(90deg, #c0392b, #dc3545);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(220, 53, 69, 0.5);
        }
        
        .btn-secondary {
            background: linear-gradient(90deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-secondary:hover {
            background: linear-gradient(90deg, #764ba2, #667eea);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(102, 126, 234, 0.5);
        }
        
        .btn-sm {
            padding: 6px 14px;
            font-size: 0.85rem;
        }

        /* Notification Message Box */
        #messageBox {
            position: fixed; 
            top: 10%; 
            right: 20px; 
            z-index: 5000; 
            padding: 20px;
            border-radius: 15px; 
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            max-width: 350px; 
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55), opacity 0.4s ease;
            background: linear-gradient(135deg, #fff 0%, #f9f9ff 100%);
            backdrop-filter: blur(10px);
            border-left: 5px solid;
            display: none; 
            flex-direction: column; 
            gap: 10px;
        }
        
        #messageBox .message-title {
            font-weight: 700;
            font-size: 1.1em;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        #messageBox .message-content {
            font-size: 0.9em;
            color: var(--color-text-dark);
        }

        .account-info {
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 2px dashed rgba(102, 126, 234, 0.3);
        }
        
        .account-info p {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(240, 147, 251, 0.1));
            padding: 1rem;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        @media (max-width: 768px) {
            .settings-grid { grid-template-columns: 1fr; }
        }
        
        /* Toggle label animation */
        .toggle-label {
            transition: all 0.3s ease;
        }
        
        .toggle-switch:hover .toggle-label {
            color: #667eea;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <!-- The messageBox container for smart notifications -->
    <div id="messageBox"></div>

    <header class="navbar">
        <div class="container nav-content">
            <a href="index.html" class="logo">üåô DreamDecoder</a>
            <nav class="nav-links">
                <a href="index.html" class="nav-item">Home</a>
                <a href="dreamnote.html" class="nav-item">Dream Note</a>
                <a href="decoder.html" class="nav-item">Dream Decoder</a>
                <a href="futureme.html" class="nav-item">FutureMe</a>
                <a href="journal.html" class="nav-item">Journal</a>
                <a href="roadmap.html" class="nav-item">Roadmap</a>
                <a href="progress.html" class="nav-item">Progress</a>
                <a href="settings.html" class="nav-item active">Settings</a>
            </nav>
        </div>
    </header>

    <main class="settings-container">
        <div class="container">
            <h2>‚öôÔ∏è User Settings</h2>
            <p>Manage your account preferences, credentials, notifications, and data.</p>

            <div class="settings-grid">
                
                <!-- 1. Account Credentials Group -->
                <div class="card setting-group">
                    <h3>üîê Account Credentials</h3>
                    
                    <div class="credential-display">
                        <div class="credential-item">
                            <span class="label">Login Email</span>
                            <span id="userEmailDisplay" class="value">loading...</span>
                        </div>
                        <button class="btn btn-secondary btn-sm" onclick="editCredential('userEmail')">Edit</button>
                    </div>

                    <div class="credential-display">
                        <div class="credential-item">
                            <span class="label">Password</span>
                            <span id="userPasswordDisplay" class="value">**********</span>
                        </div>
                        <button class="btn btn-secondary btn-sm" onclick="editCredential('userPassword')">Edit</button>
                    </div>

                    <div class="account-info setting-group">
                        <h3>Session Info</h3>
                        <p style="font-size: 0.9rem; color: #777;">User ID: <span id="userIdDisplay" style="font-weight: 600;">simulated-user-xyz123</span></p>
                        
                        <button class="btn btn-primary" style="margin-top: 1rem;" onclick="logout()">Logout</button>
                    </div>
                </div>

                <!-- 2. Smart Notifications & Data Group -->
                <div class="card setting-group">
                    <h3>üîî Smart Notifications</h3>
                    <p style="margin-bottom: 1.5rem; font-size: 0.9rem; color: #777;">Control automated reminders and message delivery alerts.</p>

                    <div class="toggle-switch">
                        <span class="toggle-label">Dream Note Reminder</span>
                        <label class="switch">
                            <input type="checkbox" id="dreamReminderToggle" onchange="saveSetting('dreamReminder', this.checked)">
                            <span class="slider"></span>
                        </label>
                    </div>

                    <div class="toggle-switch">
                        <span class="toggle-label">FutureMe Delivery Alert</span>
                        <label class="switch">
                            <input type="checkbox" id="futureMeAlertToggle" onchange="saveSetting('futureMeAlert', this.checked)">
                            <span class="slider"></span>
                        </label>
                    </div>

                    <div class="toggle-switch">
                        <span class="toggle-label">Daily Reflection Prompt</span>
                        <label class="switch">
                            <input type="checkbox" id="reflectionToggle" onchange="saveSetting('reflectionPrompt', this.checked)">
                            <span class="slider"></span>
                        </label>
                    </div>

                    <h3 style="margin-top: 2rem;">üíæ Data Management</h3>
                    <div class="toggle-switch">
                        <span class="toggle-label">Dark Mode (Simulated)</span>
                        <label class="switch">
                            <input type="checkbox" id="darkModeToggle" onchange="applyDarkMode(this.checked)">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <button class="btn btn-secondary" style="margin-top: 1rem;" onclick="exportData()">Export My Data (JSON)</button>
                </div>

            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', initSettings);

        function initSettings() {
            const email = localStorage.getItem('userEmail') || 'user@example.com';
            localStorage.setItem('userEmail', email);
            document.getElementById('userEmailDisplay').textContent = email;

            document.getElementById('darkModeToggle').checked = localStorage.getItem('darkMode') === 'true';
            document.getElementById('dreamReminderToggle').checked = localStorage.getItem('dreamReminder') === 'true';
            document.getElementById('futureMeAlertToggle').checked = localStorage.getItem('futureMeAlert') === 'true';
            document.getElementById('reflectionToggle').checked = localStorage.getItem('reflectionPrompt') === 'true';
            
            checkSmartNotifications();
        }

        function saveSetting(key, value) {
            localStorage.setItem(key, value);
            console.log('Setting "' + key + '" saved as: ' + value);
        }

        function applyDarkMode(isDark) {
            saveSetting('darkMode', isDark);
            showMessageBox('Appearance', 'Dark Mode toggled to: ' + (isDark ? 'ON' : 'OFF'), 'info');
        }

        function exportData() {
            const data = {
                dreams: JSON.parse(localStorage.getItem('savedDreams') || '[]'),
                futureMessages: JSON.parse(localStorage.getItem('futureMessages') || '[]'),
                settings: {
                    userEmail: localStorage.getItem('userEmail'),
                    darkMode: localStorage.getItem('darkMode'),
                    dreamReminder: localStorage.getItem('dreamReminder'),
                    futureMeAlert: localStorage.getItem('futureMeAlert')
                }
            };
            const json = JSON.stringify(data, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'dreamdecoder_data_export.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showMessageBox('Data Export', 'Your data has been prepared for download.', 'info');
        }

        function logout() {
            showMessageBox('Logged Out', 'You have been successfully logged out.', 'info');
            setTimeout(function() {
                window.location.href = 'index.html'; 
            }, 1000);
        }

        function editCredential(type) {
            const currentVal = localStorage.getItem(type) || (type === 'userEmail' ? 'user@example.com' : '********');
            const fieldName = type === 'userEmail' ? 'Email Address' : 'Password';
            const newValue = prompt('Enter new ' + fieldName + ':', type === 'userEmail' ? currentVal : '');
            
            if (newValue !== null && newValue.trim() !== '' && newValue !== currentVal) {
                if (type === 'userEmail' && !newValue.includes('@')) {
                    showMessageBox('Error', 'Please enter a valid email address.', 'warning');
                    return;
                }
                
                localStorage.setItem(type, newValue.trim());

                if (type === 'userEmail') {
                    document.getElementById('userEmailDisplay').textContent = newValue.trim();
                }
                
                showMessageBox('Success', fieldName + ' successfully updated!', 'info');
            } else if (newValue !== null && newValue.trim() === currentVal) {
                showMessageBox('Info', 'No change detected. The value remains the same.', 'info');
            }
        }

        function checkSmartNotifications() {
            if (localStorage.getItem('futureMeAlert') === 'true') {
                const futureMessages = JSON.parse(localStorage.getItem('futureMessages') || '[]');
                const today = new Date().toISOString().split('T')[0];

                let deliveredCount = 0;
                futureMessages.forEach(function(msg) {
                    if (msg.date <= today && !msg.delivered) {
                        showMessageBox('FUTURE ME ALERT!', 'Your message scheduled for ' + msg.date + ' is now ready! Preview: "' + msg.fullMessage.substring(0, 50) + '..."', 'info');
                        msg.delivered = true; 
                        deliveredCount++;
                    }
                });

                if (deliveredCount > 0) {
                    localStorage.setItem('futureMessages', JSON.stringify(futureMessages));
                }
            }
            
            if (localStorage.getItem('dreamReminder') === 'true') {
                const dreams = JSON.parse(localStorage.getItem('savedDreams') || '[]');
                const lastDreamDateStr = dreams.length > 0 ? dreams[dreams.length - 1].date : '2000-01-01';
                
                const lastDreamDate = new Date(lastDreamDateStr);
                const oneDayInMilliseconds = 24 * 60 * 60 * 1000;
                
                if ((new Date() - lastDreamDate) > oneDayInMilliseconds) {
                    showMessageBox('DREAM REMINDER', 'It looks like you haven\'t recorded a dream recently. Don\'t let those reflections fade!', 'warning');
                }
            }
        }

        function showMessageBox(title, message, type) {
            const box = document.getElementById('messageBox');
            if (!box) return;
            
            let color = '';
            if (type === 'info') color = '#667eea';
            else if (type === 'warning') color = '#ffc107'; 
            else color = '#343a40';

            box.style.borderLeftColor = color;
            
            box.innerHTML = '<div class="message-title" style="color: ' + color + ';">' + title + '</div>' +
                           '<div class="message-content">' + message + '</div>';
            
            box.style.opacity = '0';
            box.style.transform = 'translateX(100%)';
            box.style.display = 'flex';

            setTimeout(function() {
                box.style.opacity = '1';
                box.style.transform = 'translateX(0)';
            }, 10); 

            setTimeout(function() {
                box.style.transform = 'translateX(100%)';
                box.style.opacity = '0';
                setTimeout(function() { 
                    box.style.display = 'none'; 
                }, 300); 
            }, 6000);
        }
    </script>
</body>
</html>